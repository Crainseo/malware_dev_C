#include <stdio.h>
#include <Windows.h>
#include <fileapi.h>
#include <string.h>

#define MAX_PATH 1000

void all_file_list(char* path);

int main(void) {
	char *root_path = "C:\\Users\\Owner\\Documents\\test";
	all_file_list(root_path);
	printf("모든 파일 목록을 찾았습니다.");

	return 0;
}

void all_file_list(char* path) {
	char folder_path[MAX_PATH];
	WIN32_FIND_DATAA file_list;
	HANDLE result_handle;

	strcpy_s(folder_path, sizeof(folder_path), path);
	strcat_s(folder_path, sizeof(folder_path), "\\*");
	result_handle = FindFirstFileA(folder_path, &file_list);

	while (1) {
		if (result_handle != INVALID_HANDLE_VALUE) {
			if (strcmp(file_list.cFileName, ".") != 0 && strcmp(file_list.cFileName, "..") != 0) {
				if (file_list.dwFileAttributes == FILE_ATTRIBUTE_DIRECTORY) {
					char tmp_path[MAX_PATH];
					WIN32_FIND_DATAA tmp_file_list;
					strcpy_s(tmp_path, sizeof(tmp_path), path);
					strcat_s(tmp_path, sizeof(tmp_path), "\\");
					strcat_s(tmp_path, sizeof(tmp_path), file_list.cFileName);
					all_file_list(tmp_path);
				}
				else {
					printf("%s\n", file_list.cFileName);
				}
			}
			if (!FindNextFileA(result_handle, &file_list)) {
				break;
			}
		}
		else {
			printf("첫번째 파일 찾기에 실패하였습니다.");
			break;
		}
	}

}